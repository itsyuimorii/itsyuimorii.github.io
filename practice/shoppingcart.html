<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>React and TypeScript Shopping Cart Application | ☻ itsyuimorii.space</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content=" ">
    
    <link rel="preload" href="/assets/css/0.styles.8f3dca9f.css" as="style"><link rel="preload" href="/assets/js/app.204ed3d4.js" as="script"><link rel="preload" href="/assets/js/2.a44fb3b0.js" as="script"><link rel="preload" href="/assets/js/1.8d37d391.js" as="script"><link rel="preload" href="/assets/js/55.a4b8b234.js" as="script"><link rel="prefetch" href="/assets/js/10.d8df69df.js"><link rel="prefetch" href="/assets/js/11.2a97faa3.js"><link rel="prefetch" href="/assets/js/12.5fd72f78.js"><link rel="prefetch" href="/assets/js/13.767d92f0.js"><link rel="prefetch" href="/assets/js/14.09112e04.js"><link rel="prefetch" href="/assets/js/15.2d87bde7.js"><link rel="prefetch" href="/assets/js/16.d6bec5e2.js"><link rel="prefetch" href="/assets/js/17.3dbcb51f.js"><link rel="prefetch" href="/assets/js/18.4c170722.js"><link rel="prefetch" href="/assets/js/19.1b72b4a4.js"><link rel="prefetch" href="/assets/js/20.9741499c.js"><link rel="prefetch" href="/assets/js/21.7f8f7869.js"><link rel="prefetch" href="/assets/js/22.3f20ce36.js"><link rel="prefetch" href="/assets/js/23.7c0322e8.js"><link rel="prefetch" href="/assets/js/24.fa4b7294.js"><link rel="prefetch" href="/assets/js/25.4b75e33e.js"><link rel="prefetch" href="/assets/js/26.6ccb7807.js"><link rel="prefetch" href="/assets/js/27.6c078df5.js"><link rel="prefetch" href="/assets/js/28.520f43fd.js"><link rel="prefetch" href="/assets/js/29.844af673.js"><link rel="prefetch" href="/assets/js/3.f8c28e7e.js"><link rel="prefetch" href="/assets/js/30.b352e55d.js"><link rel="prefetch" href="/assets/js/31.c2296a43.js"><link rel="prefetch" href="/assets/js/32.f990ea1b.js"><link rel="prefetch" href="/assets/js/33.e2f64269.js"><link rel="prefetch" href="/assets/js/34.b9fe4fba.js"><link rel="prefetch" href="/assets/js/35.6015d88a.js"><link rel="prefetch" href="/assets/js/36.2ee99065.js"><link rel="prefetch" href="/assets/js/37.9bd0a687.js"><link rel="prefetch" href="/assets/js/38.04db86c7.js"><link rel="prefetch" href="/assets/js/39.1fe91b86.js"><link rel="prefetch" href="/assets/js/4.9eb8282d.js"><link rel="prefetch" href="/assets/js/40.43f0acc3.js"><link rel="prefetch" href="/assets/js/41.7bcb3391.js"><link rel="prefetch" href="/assets/js/42.d64e546e.js"><link rel="prefetch" href="/assets/js/43.a2cbbfc3.js"><link rel="prefetch" href="/assets/js/44.0492f992.js"><link rel="prefetch" href="/assets/js/45.af66bbe7.js"><link rel="prefetch" href="/assets/js/46.c1c9a53c.js"><link rel="prefetch" href="/assets/js/47.7a2bd268.js"><link rel="prefetch" href="/assets/js/48.0376d3a5.js"><link rel="prefetch" href="/assets/js/49.60535624.js"><link rel="prefetch" href="/assets/js/5.4ceb5601.js"><link rel="prefetch" href="/assets/js/50.88e721ab.js"><link rel="prefetch" href="/assets/js/51.a1a8ca8d.js"><link rel="prefetch" href="/assets/js/52.19d2519d.js"><link rel="prefetch" href="/assets/js/53.891befed.js"><link rel="prefetch" href="/assets/js/54.b3d8b254.js"><link rel="prefetch" href="/assets/js/56.710acef5.js"><link rel="prefetch" href="/assets/js/6.cb88f024.js"><link rel="prefetch" href="/assets/js/7.0f51d652.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.8ee43d73.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8f3dca9f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">☻ itsyuimorii.space</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="✸ノート" class="dropdown-title"><span class="title">✸ノート</span> <span class="arrow down"></span></button> <button type="button" aria-label="✸ノート" class="mobile-dropdown-title"><span class="title">✸ノート</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          「学習ノート」
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/guide/react/" class="nav-link">
  ▫️ React.js
</a></li><li class="dropdown-subitem"><a href="/guide/typescript/" class="nav-link">
  ▫️ Typescript
</a></li><li class="dropdown-subitem"><a href="/guide/javascript/" class="nav-link">
  ▫️ Javascript
</a></li><li class="dropdown-subitem"><a href="/guide/nextjs/" class="nav-link">
  ▫️ Next.js
</a></li></ul></li><li class="dropdown-item"><h4>
          「メモ帳」
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/memo/" class="nav-link">
  ▫️ memoメモ
</a></li><li class="dropdown-subitem"><a href="/practice/" class="nav-link router-link-active">
  ▫️ プラクティス
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="✸すべてを記録する" class="dropdown-title"><span class="title">✸すべてを記録する</span> <span class="arrow down"></span></button> <button type="button" aria-label="✸すべてを記録する" class="mobile-dropdown-title"><span class="title">✸すべてを記録する</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          ライフ
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/life/reading/" class="nav-link">
  読書メモ
</a></li><li class="dropdown-subitem"><a href="/life/moment/" class="nav-link">
  モーメント
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://github.com/itsyuimorii" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="✸ノート" class="dropdown-title"><span class="title">✸ノート</span> <span class="arrow down"></span></button> <button type="button" aria-label="✸ノート" class="mobile-dropdown-title"><span class="title">✸ノート</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          「学習ノート」
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/guide/react/" class="nav-link">
  ▫️ React.js
</a></li><li class="dropdown-subitem"><a href="/guide/typescript/" class="nav-link">
  ▫️ Typescript
</a></li><li class="dropdown-subitem"><a href="/guide/javascript/" class="nav-link">
  ▫️ Javascript
</a></li><li class="dropdown-subitem"><a href="/guide/nextjs/" class="nav-link">
  ▫️ Next.js
</a></li></ul></li><li class="dropdown-item"><h4>
          「メモ帳」
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/memo/" class="nav-link">
  ▫️ memoメモ
</a></li><li class="dropdown-subitem"><a href="/practice/" class="nav-link router-link-active">
  ▫️ プラクティス
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="✸すべてを記録する" class="dropdown-title"><span class="title">✸すべてを記録する</span> <span class="arrow down"></span></button> <button type="button" aria-label="✸すべてを記録する" class="mobile-dropdown-title"><span class="title">✸すべてを記録する</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          ライフ
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/life/reading/" class="nav-link">
  読書メモ
</a></li><li class="dropdown-subitem"><a href="/life/moment/" class="nav-link">
  モーメント
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://github.com/itsyuimorii" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/practice/" aria-current="page" class="sidebar-link">プラクティス</a></li><li><a href="/practice/todolist.html" class="sidebar-link">TodoList App</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/practice/todolist.html#プロジェクトの構成" class="sidebar-link">プロジェクトの構成</a></li><li class="sidebar-sub-header"><a href="/practice/todolist.html#tdinput-component" class="sidebar-link">TdInput Component</a></li><li class="sidebar-sub-header"><a href="/practice/todolist.html#tdlist-component" class="sidebar-link">TdList Component</a></li><li class="sidebar-sub-header"><a href="/practice/todolist.html#tditem-component" class="sidebar-link">TdItem Component</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/practice/todolist.html#定義-inputref" class="sidebar-link">定義 inputRef</a></li><li class="sidebar-sub-header"><a href="/practice/todolist.html#定義-itodo-接口" class="sidebar-link">定義 Itodo 接口</a></li><li class="sidebar-sub-header"><a href="/practice/todolist.html#定義-iprops-src-components-todolist-input-index-tsx" class="sidebar-link">定義 Iprops src/components/TodoList/Input/index.tsx</a></li></ul></li><li class="sidebar-sub-header"><a href="/practice/todolist.html#todolist-父組件" class="sidebar-link">TodoList 父組件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/practice/todolist.html#使用-usereducer-替代-usestate" class="sidebar-link">使用 useReducer 替代 useState</a></li><li class="sidebar-sub-header"><a href="/practice/todolist.html#分析-1-親コンポーネントが子コンポーネントに提供する-addtodo-関数を理解するには" class="sidebar-link">分析 1：親コンポーネントが子コンポーネントに提供する addTodo 関数を理解するには？</a></li><li class="sidebar-sub-header"><a href="/practice/todolist.html#分析-3-什麼是-action-creator-返回純函數的意思是" class="sidebar-link">分析 3 什麼是 action creator？ 返回純函數的意思是？</a></li><li class="sidebar-sub-header"><a href="/practice/todolist.html#分析-4-iprops" class="sidebar-link">分析 4： Iprops</a></li><li class="sidebar-sub-header"><a href="/practice/todolist.html#iprops-interface-for-tdinput-component" class="sidebar-link">IProps Interface for TdInput Component:</a></li><li class="sidebar-sub-header"><a href="/practice/todolist.html#iprops-interface-for-tdlist-component" class="sidebar-link">IProps Interface for TdList Component:</a></li><li class="sidebar-sub-header"><a href="/practice/todolist.html#common-aspects" class="sidebar-link">Common Aspects:</a></li><li class="sidebar-sub-header"><a href="/practice/todolist.html#iprops-in-the-todolist-input-index-tsx" class="sidebar-link">IProps in the TodoList&gt;input&gt;index.tsx</a></li></ul></li></ul></li><li><a href="/practice/shoppingcart.html" aria-current="page" class="active sidebar-link">React and TypeScript Shopping Cart Application</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/practice/shoppingcart.html#🔷-cartprovider-component" class="sidebar-link">🔷 CartProvider Component</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/practice/shoppingcart.html#_1-type-definitions" class="sidebar-link">1. Type Definitions</a></li><li class="sidebar-sub-header"><a href="/practice/shoppingcart.html#_2-action-types-definition" class="sidebar-link">2. Action Types Definition</a></li><li class="sidebar-sub-header"><a href="/practice/shoppingcart.html#_3-reducer-function" class="sidebar-link">3. Reducer Function</a></li><li class="sidebar-sub-header"><a href="/practice/shoppingcart.html#_4-custom-hook-usecartcontext" class="sidebar-link">4. Custom Hook: useCartContext</a></li><li class="sidebar-sub-header"><a href="/practice/shoppingcart.html#_5-react-context-and-provider" class="sidebar-link">5. React Context and Provider</a></li><li class="sidebar-sub-header"><a href="/practice/shoppingcart.html#usage-instructions" class="sidebar-link">Usage Instructions</a></li><li class="sidebar-sub-header"><a href="/practice/shoppingcart.html#🔻-cartprovider-code-review" class="sidebar-link">🔻 CartProvider Code review</a></li></ul></li><li class="sidebar-sub-header"><a href="/practice/shoppingcart.html#🔷-productsprovider-component" class="sidebar-link">🔷 ProductsProvider Component</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/practice/shoppingcart.html#_1-type-definitions-2" class="sidebar-link">1. Type Definitions</a></li><li class="sidebar-sub-header"><a href="/practice/shoppingcart.html#_2-initial-state" class="sidebar-link">2. Initial State</a></li><li class="sidebar-sub-header"><a href="/practice/shoppingcart.html#_3-context-type-definition" class="sidebar-link">3. Context Type Definition</a></li><li class="sidebar-sub-header"><a href="/practice/shoppingcart.html#_4-react-context-and-provider" class="sidebar-link">4. React Context and Provider</a></li><li class="sidebar-sub-header"><a href="/practice/shoppingcart.html#_5-fetching-and-updating-product-data" class="sidebar-link">5. Fetching and Updating Product Data</a></li><li class="sidebar-sub-header"><a href="/practice/shoppingcart.html#usage-instructions-2" class="sidebar-link">Usage Instructions</a></li><li class="sidebar-sub-header"><a href="/practice/shoppingcart.html#🔻-productsprovider-code-review" class="sidebar-link">🔻 ProductsProvider Code review</a></li></ul></li><li class="sidebar-sub-header"><a href="/practice/shoppingcart.html#🔷-hooks-useproducts-hook" class="sidebar-link">🔷 Hooks/useProducts Hook</a></li><li class="sidebar-sub-header"><a href="/practice/shoppingcart.html#🔷-hooks-usecart-hook" class="sidebar-link">🔷 Hooks/useCart Hook</a></li><li class="sidebar-sub-header"><a href="/practice/shoppingcart.html#🔷-components-productlist" class="sidebar-link">🔷 components/ProductList</a></li><li class="sidebar-sub-header"><a href="/practice/shoppingcart.html#🔷-components-product" class="sidebar-link">🔷 components/Product</a></li><li class="sidebar-sub-header"><a href="/practice/shoppingcart.html#トラブルシューティング" class="sidebar-link">トラブルシューティング</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/practice/shoppingcart.html#▫️-usecartcontext-hooks" class="sidebar-link">▫️ useCartContext hooks</a></li><li class="sidebar-sub-header"><a href="/practice/shoppingcart.html#▫️-usecartcontexttype" class="sidebar-link">▫️ UseCartContextType</a></li></ul></li></ul></li><li><a href="/practice/github.html" class="sidebar-link">/practice/github.html</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="react-and-typescript-shopping-cart-application"><a href="#react-and-typescript-shopping-cart-application" class="header-anchor">#</a> React and TypeScript Shopping Cart Application</h1> <h2 id="🔷-cartprovider-component"><a href="#🔷-cartprovider-component" class="header-anchor">#</a> 🔷 CartProvider Component</h2> <blockquote><p>path: <code>src/Context/CartProvider.tsx</code></p></blockquote> <h3 id="_1-type-definitions"><a href="#_1-type-definitions" class="header-anchor">#</a> 1. Type Definitions</h3> <blockquote><p>CartItemType</p></blockquote> <p>Defines the structure of a single shopping cart item.</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">type</span> <span class="token class-name">CartItemType</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  sku<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  price<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  qty<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>CartStateType</p></blockquote> <p>Defines the type for the shopping cart state.</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">type</span> <span class="token class-name">CartStateType</span> <span class="token operator">=</span> <span class="token punctuation">{</span> cart<span class="token operator">:</span> CartItemType<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_2-action-types-definition"><a href="#_2-action-types-definition" class="header-anchor">#</a> 2. Action Types Definition</h3> <blockquote><p>REDUCER_ACTION_TYPE</p></blockquote> <p>An object defining various action types for updating the state.</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> <span class="token constant">REDUCER_ACTION_TYPE</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token constant">ADD</span><span class="token operator">:</span> <span class="token string">&quot;ADD&quot;</span><span class="token punctuation">,</span>
  <span class="token constant">REMOVE</span><span class="token operator">:</span> <span class="token string">&quot;REMOVE&quot;</span><span class="token punctuation">,</span>
  <span class="token constant">QUANTITY</span><span class="token operator">:</span> <span class="token string">&quot;QUANTITY&quot;</span><span class="token punctuation">,</span>
  <span class="token constant">SUBMIT</span><span class="token operator">:</span> <span class="token string">&quot;SUBMIT&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>ReducerActionType</p></blockquote> <p>Extracts the type of <code>REDUCER_ACTION_TYPE</code> object.</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">type</span> <span class="token class-name">ReducerActionType</span> <span class="token operator">=</span> <span class="token keyword">typeof</span> <span class="token constant">REDUCER_ACTION_TYPE</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>ReducerAction</p></blockquote> <p>Defines the structure of the action object expected by the reducer function.</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">type</span> <span class="token class-name">ReducerAction</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  type<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  payload<span class="token operator">?</span><span class="token operator">:</span> CartItemType<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_3-reducer-function"><a href="#_3-reducer-function" class="header-anchor">#</a> 3. Reducer Function</h3> <blockquote><p>reducer</p></blockquote> <p>A core function that handles changes in the shopping cart state.</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> <span class="token function-variable function">reducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span>state<span class="token operator">:</span> CartStateType<span class="token punctuation">,</span> action<span class="token operator">:</span> ReducerAction<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...switch case statements</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_4-custom-hook-usecartcontext"><a href="#_4-custom-hook-usecartcontext" class="header-anchor">#</a> 4. Custom Hook: useCartContext</h3> <blockquote><p>useCartContext</p></blockquote> <p>A custom React Hook providing a context related to the shopping cart.</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> <span class="token function-variable function">useCartContext</span> <span class="token operator">=</span> <span class="token punctuation">(</span>initialCartState<span class="token operator">:</span> CartStateType<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...hook implementation</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_5-react-context-and-provider"><a href="#_5-react-context-and-provider" class="header-anchor">#</a> 5. React Context and Provider</h3> <blockquote><p>CartContext</p></blockquote> <p>Creates a React Context to share the shopping cart state across components.</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">const</span> CartContext <span class="token operator">=</span> <span class="token generic-function"><span class="token function">createContext</span><span class="token generic class-name"><span class="token operator">&lt;</span>UseCartContextType<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  initalCartContextState
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>CartProvider</p></blockquote> <p>A React component using <code>useCartContext</code> Hook and <code>CartContext.Provider</code> to provide the shopping cart context to the application.</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">const</span> CartProvider <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> children <span class="token punctuation">}</span><span class="token operator">:</span> ChildrenType<span class="token punctuation">)</span><span class="token operator">:</span> ReactElement <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...provider implementation</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="usage-instructions"><a href="#usage-instructions" class="header-anchor">#</a> Usage Instructions</h3> <p>Use <code>useContext(CartContext)</code> in components that need to access or modify the shopping cart state.
Example: To add an item to the cart, use <code>dispatch({ type: 'ADD', payload: newItem })</code>.</p> <h3 id="🔻-cartprovider-code-review"><a href="#🔻-cartprovider-code-review" class="header-anchor">#</a> 🔻 CartProvider Code review</h3> <div class="language-tsx extra-class"><pre class="language-tsx"><code>
<span class="token comment">//path: src/context/CartProvider.tsx</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> ReactElement<span class="token punctuation">,</span> createContext<span class="token punctuation">,</span> useMemo<span class="token punctuation">,</span> useReducer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>

<span class="token comment">//用於描述單個購物車項目的結構。</span>

<span class="token keyword">export</span> <span class="token keyword">type</span> <span class="token class-name">CartItemType</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
sku<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
price<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
qty<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//1. 定義購物車相關的 TypeScript 類型</span>
<span class="token comment">//定義購物車狀態類型</span>
<span class="token comment">//它是一個包含單個屬性 cart 的對象，而 cart 是一個 CartItemType[] 類型的數組。</span>
<span class="token keyword">type</span> <span class="token class-name">CartStateType</span> <span class="token operator">=</span> <span class="token punctuation">{</span> cart<span class="token operator">:</span> CartItemType<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> initialCartState<span class="token operator">:</span> CartStateType <span class="token operator">=</span> <span class="token punctuation">{</span> cart<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//2. 定義用於更新購物車狀態的 Action 類型</span>
<span class="token comment">//2.1 這是一個對象，其中定義了用於更新狀態的各種 action 的類型。如 ADD，REMOVE，QUANTITY，SUBMIT。 這些是你將在應用中用來描述發生的事件的常量。</span>
<span class="token keyword">const</span> <span class="token constant">REDUCER_ACTION_TYPE</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
<span class="token constant">ADD</span><span class="token operator">:</span> <span class="token string">&quot;ADD&quot;</span><span class="token punctuation">,</span>
<span class="token constant">REMOVE</span><span class="token operator">:</span> <span class="token string">&quot;REMOVE&quot;</span><span class="token punctuation">,</span>
<span class="token constant">QUANTITY</span><span class="token operator">:</span> <span class="token string">&quot;QUANTITY&quot;</span><span class="token punctuation">,</span>
<span class="token constant">SUBMIT</span><span class="token operator">:</span> <span class="token string">&quot;SUBMIT&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

 <span class="token comment">//2.2 通過 typeof 獲取 REDUCER_ACTION_TYPE 的對象的類型，並將這個類型導出為 ReducerActionType。 這樣做的好處是你獲得了一個精確的類型，代表 REDUCER_ACTION_TYPE 的結構，而不僅僅是一個簡單的對象。這在 TypeScript 中有助於提高類型安全性和自動完成。</span>



<span class="token keyword">export</span> <span class="token keyword">type</span> <span class="token class-name">ReducerActionType</span> <span class="token operator">=</span> <span class="token keyword">typeof</span> <span class="token constant">REDUCER_ACTION_TYPE</span><span class="token punctuation">;</span>
<span class="token comment">//2.3 定義了傳遞給 reducer 函數的 action 對象的結構。 包含 type（動作類型）和 payload（附加數據，可選）。</span>

<span class="token comment">//這是另一個 TypeScript 類型定義，用於描述 reducer 函數期望接收的 action 對象的結構。每個 action 都有一個 type 屬性，它是一個字符串，應對應於 REDUCER_ACTION_TYPE 中定義的一個值。payload 是一個可選屬性，包含了任何附加的數據（在這種情況下是 CartItemType）。</span>
<span class="token keyword">export</span> <span class="token keyword">type</span> <span class="token class-name">ReducerAction</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
type<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
payload<span class="token operator">?</span><span class="token operator">:</span> CartItemType<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//3. Reducer 函數</span>
<span class="token comment">//3.1 Reducer Function (reducer): 這是核心功能之一，用於處理購物車狀態的變化。它根據不同的動作（添加、移除、修改數量、提交）來更新狀態。這種方式能夠集中管理狀態的變更，是 Redux 架構中的一部分。</span>
<span class="token keyword">const</span> <span class="token function-variable function">reducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span>state<span class="token operator">:</span> CartStateType<span class="token punctuation">,</span> action<span class="token operator">:</span> ReducerAction<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">case</span> <span class="token constant">REDUCER_ACTION_TYPE</span><span class="token punctuation">.</span><span class="token constant">ADD</span><span class="token operator">:</span> <span class="token punctuation">{</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>action<span class="token punctuation">.</span>payload<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;action.payload missing in ADD action&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> sku<span class="token punctuation">,</span> name<span class="token punctuation">,</span> price <span class="token punctuation">}</span> <span class="token operator">=</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">;</span>
<span class="token comment">//如果 sku 不等于给定的值，这个元素就会被保留在新数组 filteredCart 中，否则将被排除。</span>
<span class="token keyword">const</span> filteredCart<span class="token operator">:</span> CartItemType<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> state<span class="token punctuation">.</span>cart<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>
<span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>sku <span class="token operator">!==</span> sku
<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">const</span> itemExisted<span class="token operator">:</span> CartItemType <span class="token operator">|</span> <span class="token keyword">undefined</span> <span class="token operator">=</span> state<span class="token punctuation">.</span>cart<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>
        <span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>sku <span class="token operator">===</span> sku
      <span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">const</span> qty<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> itemExisted <span class="token operator">?</span> itemExisted<span class="token punctuation">.</span>qty <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> cart<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span>filteredCart<span class="token punctuation">,</span> <span class="token punctuation">{</span> sku<span class="token punctuation">,</span> name<span class="token punctuation">,</span> price<span class="token punctuation">,</span> qty <span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">case</span> <span class="token constant">REDUCER_ACTION_TYPE</span><span class="token punctuation">.</span><span class="token constant">REMOVE</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>action<span class="token punctuation">.</span>payload<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;action.payload missing in REMOVE action&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> sku <span class="token punctuation">}</span> <span class="token operator">=</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">;</span>

      <span class="token keyword">const</span> filteredCart<span class="token operator">:</span> CartItemType<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> state<span class="token punctuation">.</span>cart<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>
        <span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>sku <span class="token operator">!==</span> sku
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> cart<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span>filteredCart<span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//然后，它创建一个名为 updatedItem 的对象，该对象是购物车中现有商品的副本，但具有更新的 qty。最后，它创建一个名为 filteredCart 的新数组，其中包含所有其他商品，但不包括要更新的商品。</span>
    <span class="token keyword">case</span> <span class="token constant">REDUCER_ACTION_TYPE</span><span class="token punctuation">.</span><span class="token constant">QUANTITY</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>action<span class="token punctuation">.</span>payload<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;action.payload missing in QUANTITY action&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> sku<span class="token punctuation">,</span> qty <span class="token punctuation">}</span> <span class="token operator">=</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">;</span>

      <span class="token keyword">const</span> itemExists<span class="token operator">:</span> CartItemType <span class="token operator">|</span> <span class="token keyword">undefined</span> <span class="token operator">=</span> state<span class="token punctuation">.</span>cart<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>
        <span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>sku <span class="token operator">===</span> sku
      <span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>itemExists<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;item must exist in order to update quantity&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// 创建一个更新后的商品对象</span>
      <span class="token keyword">const</span> updatedItem<span class="token operator">:</span> CartItemType <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>itemExists<span class="token punctuation">,</span> qty <span class="token punctuation">}</span><span class="token punctuation">;</span>

      <span class="token comment">// 创建一个新的购物车数组，其中包括更新后的商品</span>
      <span class="token keyword">const</span> filteredCart<span class="token operator">:</span> CartItemType<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> state<span class="token punctuation">.</span>cart<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>
        <span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>sku <span class="token operator">!==</span> sku
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> cart<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span>filteredCart<span class="token punctuation">,</span> updatedItem<span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token comment">// map 方法 ： 创建一个新的购物车数组，其中包括更新后的商品</span>
      <span class="token comment">// const filteredCart: CartItemType[] = state.cart.map((item) =&gt;</span>
      <span class="token comment">// item.sku === sku ? updatedItem : item</span>
      <span class="token comment">// );</span>
      <span class="token comment">// 返回更新后的购物车状态</span>
      <span class="token comment">// return { ...state, cart: filteredCart };</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">case</span> <span class="token constant">REDUCER_ACTION_TYPE</span><span class="token punctuation">.</span><span class="token constant">SUBMIT</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> cart<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Unidentified reducer action type&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 4. 自定義 Hook：useCartContext</span>

<span class="token operator">/</span>\<span class="token operator">*</span>\<span class="token operator">*</span>
<span class="token operator">*</span>使用 useReducer 來管理購物車狀態。
<span class="token operator">*</span>用 useMemo 來緩存計算結果（<span class="token constant">REDUCER_ACTIONS</span>）。
<span class="token operator">*</span>計算購物車的總數量和總價格。
<span class="token operator">*</span>對購物車中的商品進行排序。\<span class="token operator">*</span><span class="token operator">/</span>

<span class="token comment">//useCartContext 是一个自定义的 React Hook，它的作用是为你的应用程序提供一个与购物车相关的上下文。这个上下文包含了购物车的状态以及与购物车操作相关的函数，例如添加商品、删除商品、更新商品数量等。</span>

<span class="token comment">//自定義 Hook 如 useCartContext 被用來封裝和共享邏輯，相同的邏輯可以在應用中的多個地方使用，而不必重複相同的代碼。 useCartContext 接受一个参数 initialCartState，它是购物车的初始状态，包含一个空的购物车数组。</span>
<span class="token keyword">const</span> <span class="token function-variable function">useCartContext</span> <span class="token operator">=</span> <span class="token punctuation">(</span>initialCartState<span class="token operator">:</span> CartStateType<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> initialCartState<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//useMemo 主要用于缓存计算结果，并在依赖项（dependencies）发生变化时重新计算。</span>
<span class="token keyword">const</span> <span class="token constant">REDUCER_ACTIONS</span> <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span class="token keyword">return</span> <span class="token constant">REDUCER_ACTION_TYPE</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> totalItems <span class="token operator">=</span> state<span class="token punctuation">.</span>cart<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>previousValue<span class="token punctuation">,</span> cartItem<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span class="token keyword">return</span> previousValue <span class="token operator">+</span> cartItem<span class="token punctuation">.</span>qty<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> totalPrice <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intl</span><span class="token punctuation">.</span><span class="token function">NumberFormat</span><span class="token punctuation">(</span><span class="token string">&quot;en-US&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
style<span class="token operator">:</span> <span class="token string">&quot;currency&quot;</span><span class="token punctuation">,</span>
currency<span class="token operator">:</span> <span class="token string">&quot;USD&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>
state<span class="token punctuation">.</span>cart<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>previousValue<span class="token punctuation">,</span> cartItem<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span class="token keyword">return</span> previousValue <span class="token operator">+</span> cartItem<span class="token punctuation">.</span>qty \<span class="token operator">*</span> cartItem<span class="token punctuation">.</span>price<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 这段代码的作用是对购物车中的商品进行排序，排序的规则是按照商品的 sku 属性的后四位数字进行升序排序。</span>
<span class="token keyword">const</span> cart <span class="token operator">=</span> state<span class="token punctuation">.</span>cart<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span class="token comment">//分别提取了商品 a 和 b 的 sku 属性的后四位数字部分。这些数字会被转换成数值类型。</span>
<span class="token keyword">const</span> itemA <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>sku<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> itemB <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>sku<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//表示根据提取出的数字进行升序排序，即如果 itemA 小于 itemB，返回负数；如果 itemA 等于 itemB，返回零；如果 itemA 大于 itemB，返回正数。</span>
<span class="token keyword">return</span> itemA <span class="token operator">-</span> itemB<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">return</span> <span class="token punctuation">{</span> dispatch<span class="token punctuation">,</span> <span class="token constant">REDUCER_ACTIONS</span><span class="token punctuation">,</span> totalPrice<span class="token punctuation">,</span> totalItems<span class="token punctuation">,</span> cart <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//这里使用了 TypeScript 的 ReturnType 工具类型，它用于获取一个函数返回值的类型 。typeof useCartContext 表示获取 useCartContext 函数的类型，ReturnType&lt;typeof useCartContext&gt; 则是这个函数返回值的类型。这个类型被用作下面 CartContext 的类型参数。</span>

<span class="token comment">//返回值是什么 : useCartContext Hook 的返回值是一个对象，包含了与购物车相关的数据和函数。这通常包括购物车的状态（如商品列表、总价等）以及用于更新这些状态的方法（如 dispatch 方法）。</span>
<span class="token keyword">export</span> <span class="token keyword">type</span> <span class="token class-name">UseCartContextType</span> <span class="token operator">=</span> ReturnType<span class="token operator">&lt;</span><span class="token keyword">typeof</span> useCartContext<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token comment">//Context and Provider (CartContext 和 CartProvider): 這個部分創建了一個 React Context 來跨組件共享購物車的狀態和操作。CartProvider 組件則將這個上下文應用於應用程序的根組件。</span>

<span class="token comment">//这里定义了初始的上下文状态。initalCartContextState 符合 UseCartContextType 类型，包含了 dispatch 函数、REDUCER_ACTIONS 常量、以及一些购物车相关的状态如 totalItems、totalPrice 和 cart。dispatch 函数是一个空函数，表示在默认情况下不执行任何操作。</span>
<span class="token keyword">const</span> initalCartContextState<span class="token operator">:</span> UseCartContextType <span class="token operator">=</span> <span class="token punctuation">{</span>
<span class="token function-variable function">dispatch</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token constant">REDUCER_ACTIONS</span><span class="token operator">:</span> <span class="token constant">REDUCER_ACTION_TYPE</span><span class="token punctuation">,</span>
totalItems<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
totalPrice<span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
cart<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//5. React Context 和 Provider</span>

<span class="token comment">// 創建一個 React Context，允許跨組件共享購物車狀態。 用於在應用程序中提供購物車的狀態和操作。其他組件可以使用這個 Context 來訪問購物車的狀態。</span>
<span class="token comment">//const SomeContext = createContext(defaultValue)</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> CartContext <span class="token operator">=</span> <span class="token generic-function"><span class="token function">createContext</span><span class="token generic class-name"><span class="token operator">&lt;</span>UseCartContextType<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
initalCartContextState
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">ChildrenType</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
children<span class="token operator">?</span><span class="token operator">:</span> ReactElement <span class="token operator">|</span> ReactElement<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//使用 CartContext.Provider 來將 useCartContext 的返回值作為上下文值提供給其子組件。 CartProvider 組件：這是一個 React 組件，它使用 useCartContext Hook 並通過 CartContext.Provider 提供購物車上下文給應用程序。它包裝了應用程序的根組件，使購物車上下文對整個應用程序可用。</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> CartProvider <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> children <span class="token punctuation">}</span><span class="token operator">:</span> ChildrenType<span class="token punctuation">)</span><span class="token operator">:</span> ReactElement <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span class="token keyword">return</span> <span class="token punctuation">(</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">CartContext.Provider</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token function">useCartContext</span><span class="token punctuation">(</span>initialCartState<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">CartContext.Provider</span></span><span class="token punctuation">&gt;</span></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//使用 Custom Hook 和 Context:</span>

<span class="token comment">//在需要訪問或修改購物車狀態的組件中，使用 useContext(CartContext) 來獲取購物車的狀態和 dispatch 函數。例如，如果需要向購物車中添加一個商品，可以使用 dispatch({ type: 'ADD', payload: newItem })。</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> CartContext<span class="token punctuation">;</span>

<span class="token operator">/</span>_ 使用說明
在需要訪問或修改購物車狀態的組件中，使用 <span class="token function">useContext</span><span class="token punctuation">(</span>CartContext<span class="token punctuation">)</span> 來獲取購物車的狀態和 dispatch 函數。
例如，添加商品到購物車可以使用 <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'ADD'</span><span class="token punctuation">,</span> payload<span class="token operator">:</span> newItem <span class="token punctuation">}</span><span class="token punctuation">)</span>。 _<span class="token operator">/</span>

</code></pre></div><h2 id="🔷-productsprovider-component"><a href="#🔷-productsprovider-component" class="header-anchor">#</a> 🔷 ProductsProvider Component</h2> <blockquote><p>path: <code>src/Context/ProductsProvider.tsx</code></p></blockquote> <h3 id="_1-type-definitions-2"><a href="#_1-type-definitions-2" class="header-anchor">#</a> 1. Type Definitions</h3> <blockquote><p>ProductType</p></blockquote> <p>Defines the structure of a product.</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">type</span> <span class="token class-name">ProductType</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  sku<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  price<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_2-initial-state"><a href="#_2-initial-state" class="header-anchor">#</a> 2. Initial State</h3> <blockquote><p>initialState</p></blockquote> <p>An array that holds the initial state of the product list.</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> initialState<span class="token operator">:</span> ProductType<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_3-context-type-definition"><a href="#_3-context-type-definition" class="header-anchor">#</a> 3. Context Type Definition</h3> <blockquote><p>UseProductsContextType</p></blockquote> <p>Defines the shape of the context used for managing product information.</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">type</span> <span class="token class-name">UseProductsContextType</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  products<span class="token operator">:</span> ProductType<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_4-react-context-and-provider"><a href="#_4-react-context-and-provider" class="header-anchor">#</a> 4. React Context and Provider</h3> <blockquote><p>ProductsContext</p></blockquote> <p>Creates a React Context for sharing and managing product information globally.</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">const</span> ProductsContext <span class="token operator">=</span>
  <span class="token generic-function"><span class="token function">createContext</span><span class="token generic class-name"><span class="token operator">&lt;</span>UseProductsContextType<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>initialContextState<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>ProductsProvider</p></blockquote> <p>A React component that provides the product context to the application using the <code>ProductsContext.Provider</code>.</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">const</span> ProductsProvider <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> children <span class="token punctuation">}</span><span class="token operator">:</span> ChildrenType<span class="token punctuation">)</span><span class="token operator">:</span> ReactElement <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...provider implementation</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_5-fetching-and-updating-product-data"><a href="#_5-fetching-and-updating-product-data" class="header-anchor">#</a> 5. Fetching and Updating Product Data</h3> <blockquote><p>useEffect Hook</p></blockquote> <p>Fetches product data from an external source and updates the state.</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Function to fetch products and error handling</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="usage-instructions-2"><a href="#usage-instructions-2" class="header-anchor">#</a> Usage Instructions</h3> <p>Use <code>useContext(ProductsContext)</code> in components that need to access or modify the product information.
Example: To access the list of products, use <code>const { products } = useContext(ProductsContext)</code>.</p> <p>This Markdown note provides a structured overview of your React and TypeScript product management application, outlining type definitions, initial state, context and provider, along with instructions for fetching and updating product data.</p> <h3 id="🔻-productsprovider-code-review"><a href="#🔻-productsprovider-code-review" class="header-anchor">#</a> 🔻 ProductsProvider Code review</h3> <div class="language-tsx extra-class"><pre class="language-tsx"><code>
<span class="token comment">////这里定义了一个名为 ProductType 的 TypeScript</span>
类型，该类型描述了产品的结构，包括sku（库存单位）、name（名称）和price（价格）等属性。
<span class="token operator">...</span>


<span class="token keyword">import</span> <span class="token punctuation">{</span> ReactElement<span class="token punctuation">,</span> createContext<span class="token punctuation">,</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">type</span> <span class="token class-name">ProductType</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  sku<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  price<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//const initState: ProductType[] = []</span>



<span class="token keyword">const</span> initialState<span class="token operator">:</span> ProductType<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

 <span class="token comment">//这里定义了一个名为 initState的常量，它是一个数组，包含了一些产品对象。这个数组通常用于初始化应用程序的状态，可以在React的上下文中使用。</span>

<span class="token comment">// export const initialState: ProductType[] = [</span>
<span class="token comment">//   {</span>
<span class="token comment">//     sku: &quot;item0001&quot;,</span>
<span class="token comment">//     name: &quot;Widget&quot;,</span>
<span class="token comment">//     price: 9.99,</span>
<span class="token comment">//   },</span>
<span class="token comment">//   {</span>
<span class="token comment">//     sku: &quot;item0002&quot;,</span>
<span class="token comment">//     name: &quot;Premium Widget&quot;,</span>
<span class="token comment">//     price: 19.99,</span>
<span class="token comment">//   },</span>
<span class="token comment">//   {</span>
<span class="token comment">//     sku: &quot;item0003&quot;,</span>
<span class="token comment">//     name: &quot;Deluxe Widget&quot;,</span>
<span class="token comment">//     price: 29.99,</span>
<span class="token comment">//   },</span>
<span class="token comment">// ];</span>

<span class="token comment">//它描述了一个用于管理产品信息的上下文的形状。具体来说，它包含一个属性(object) products，其值是一个 ProductType 类型的数组，用于存储产品信息。</span>
<span class="token keyword">export</span> <span class="token keyword">type</span> <span class="token class-name">UseProductsContextType</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  products<span class="token operator">:</span> ProductType<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> initialContextState<span class="token operator">:</span> UseProductsContextType <span class="token operator">=</span> <span class="token punctuation">{</span>
  products<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token comment">//最后，它创建了一个名为 ProductsContext 的上下文对象，使用了之前定义的 UseProductsContextType 类型作为泛型参数，并将初始状態initialContextState传递给createContext函数。这个上下文对象可以在应用程序中使用，用于共享和管理产品信息的全局状态。</span>

<span class="token keyword">type</span> <span class="token class-name">ChildrenType</span> <span class="token operator">=</span> <span class="token punctuation">{</span> children<span class="token operator">?</span><span class="token operator">:</span> ReactElement <span class="token operator">|</span> ReactElement<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> ProductsContext <span class="token operator">=</span>
  <span class="token generic-function"><span class="token function">createContext</span><span class="token generic class-name"><span class="token operator">&lt;</span>UseProductsContextType<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>initialContextState<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> ProductsProvider <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> children <span class="token punctuation">}</span><span class="token operator">:</span> ChildrenType<span class="token punctuation">)</span><span class="token operator">:</span> ReactElement <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>products<span class="token punctuation">,</span> setProducts<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useState</span><span class="token generic class-name"><span class="token operator">&lt;</span>ProductType<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>initialState<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> fetchProducts <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>ProductType<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost:3500/products&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>res<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Network response was not ok&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">const</span> data<span class="token operator">:</span> ProductType<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> data<span class="token punctuation">;</span> <span class="token comment">// 返回产品数据</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">(</span>error <span class="token keyword">as</span> Error<span class="token punctuation">)</span><span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 使用类型断言将 error 标记为 Error 类型</span>
        <span class="token keyword">throw</span> error<span class="token punctuation">;</span> <span class="token comment">// 抛出错误，使外部可以捕获</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token function">fetchProducts</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>products<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setProducts</span><span class="token punctuation">(</span>products<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token comment">// eslint-disable-next-line @typescript-eslint/no-unused-vars</span>
      <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 在此处可以进一步处理错误，例如显示错误消息</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ProductsContext.Provider</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> products <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">ProductsContext.Provider</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> ProductsContext<span class="token punctuation">;</span>
</code></pre></div><p><code>ProductType[]</code>是一个表示产品数组的类型定义。而 <code>UseProductContextType</code>是另一个类型定义，它定义了一个对象，这个对象包含了一个名为<code>products</code>的字段，其类型为 <code>ProductType[]</code>。</p> <h2 id="🔷-hooks-useproducts-hook"><a href="#🔷-hooks-useproducts-hook" class="header-anchor">#</a> 🔷 Hooks/useProducts Hook</h2> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> ProductsContext <span class="token keyword">from</span> <span class="token string">&quot;../context/ProductsProvider&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> UseProductsContextType <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../context/ProductsProvider&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> useProducts <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> UseProductsContextType <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">useContext</span><span class="token punctuation">(</span>ProductsContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> useProducts<span class="token punctuation">;</span>
</code></pre></div><h2 id="🔷-hooks-usecart-hook"><a href="#🔷-hooks-usecart-hook" class="header-anchor">#</a> 🔷 Hooks/useCart Hook</h2> <blockquote><p>它的作用是简化了在组件中使用购物车上下文（CartContext）的过程。这个 Hook 返回了 CartContext 的值，使得在组件中访问购物车数据和操作更加直观和便捷。这种模式非常适用于将上下文的逻辑封装起来，以便在多个组件中重用。</p></blockquote> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> CartContext <span class="token keyword">from</span> <span class="token string">&quot;../context/CartProvider&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> UseCartContextType <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../context/CartProvider&quot;</span><span class="token punctuation">;</span>
<span class="token comment">//通过指定返回类型为 UseCartContextType，这个 Hook 的使用者可以得到关于返回值的类型提示和校验。</span>
<span class="token keyword">const</span> useCart <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> UseCartContextType <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">useContext</span><span class="token punctuation">(</span>CartContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> useCart<span class="token punctuation">;</span>
</code></pre></div><hr> <h2 id="🔷-components-productlist"><a href="#🔷-components-productlist" class="header-anchor">#</a> 🔷 components/ProductList</h2> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> ReactElement <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> useCart <span class="token keyword">from</span> <span class="token string">&quot;../hooks/useCart&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> useProdudcts <span class="token keyword">from</span> <span class="token string">&quot;../hooks/useProducts&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Product <span class="token keyword">from</span> <span class="token string">&quot;./Product&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">ProductList</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> dispatch<span class="token punctuation">,</span> <span class="token constant">REDUCER_ACTIONS</span><span class="token punctuation">,</span> cart <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useCart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> products <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useProdudcts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//使用 some 方法檢查：具體地，inCart 的值是通過檢查購物車（cart）中是否存在具有相同 sku 值的產品來確定的。這通過使用 Array.prototype.some 方法實現，這個方法會測試陣列中是否至少有一個元素滿足提供的函數。如果滿足條件（即購物車中已有相同 sku 的產品），則 inCart 為 true；否則，為 false。</span>

  <span class="token keyword">let</span> pageContent<span class="token operator">:</span> ReactElement <span class="token operator">|</span> ReactElement<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Loading...</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>products<span class="token operator">?.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    pageContent <span class="token operator">=</span> products<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>product<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> inCart<span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token operator">=</span> cart<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>sku <span class="token operator">===</span> product<span class="token punctuation">.</span>sku<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span></span>
          <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>product<span class="token punctuation">.</span>sku<span class="token punctuation">}</span></span>
          <span class="token attr-name">product</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>product<span class="token punctuation">}</span></span>
          <span class="token attr-name">dispatch</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>dispatch<span class="token punctuation">}</span></span>
          <span class="token attr-name">REDUCER_ACTIONS</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token constant">REDUCER_ACTIONS</span><span class="token punctuation">}</span></span>
          <span class="token attr-name">inCart</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>inCart<span class="token punctuation">}</span></span>
        <span class="token punctuation">/&gt;</span></span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> content <span class="token operator">=</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>main</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>main main--products<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>pageContent<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>main</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> content<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> ProductList<span class="token punctuation">;</span>
</code></pre></div><h2 id="🔷-components-product"><a href="#🔷-components-product" class="header-anchor">#</a> 🔷 components/Product</h2> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token comment">// 引入所需的依賴和類型</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ProductType <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../context/ProductsProvider&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ReducerActionType<span class="token punctuation">,</span> ReducerAction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../context/CartProvider&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ReactElement<span class="token punctuation">,</span> memo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 定義 PropsType，用於描述 Product 組件的屬性</span>
<span class="token keyword">type</span> <span class="token class-name">PropsType</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  product<span class="token operator">:</span> ProductType<span class="token punctuation">;</span> <span class="token comment">// 產品信息</span>
  dispatch<span class="token operator">:</span> React<span class="token punctuation">.</span>Dispatch<span class="token operator">&lt;</span>ReducerAction<span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token comment">// 購物車操作的 dispatch 函數</span>
  <span class="token constant">REDUCER_ACTIONS</span><span class="token operator">:</span> ReducerActionType<span class="token punctuation">;</span> <span class="token comment">// 購物車操作的行為類型</span>
  inCart<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span> <span class="token comment">// 產品是否已在購物車中的標記</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Product 組件定義</span>
<span class="token keyword">const</span> Product <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  product<span class="token punctuation">,</span>
  dispatch<span class="token punctuation">,</span>
  <span class="token constant">REDUCER_ACTIONS</span><span class="token punctuation">,</span>
  inCart<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token operator">:</span> PropsType<span class="token punctuation">)</span><span class="token operator">:</span> ReactElement <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 產品圖片的路徑</span>
  <span class="token keyword">const</span> img<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">URL</span></span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">../images/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>product<span class="token punctuation">.</span>sku<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.jpg</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>url<span class="token punctuation">)</span>
    <span class="token punctuation">.</span>href<span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 添加產品到購物車的事件處理函數</span>
  <span class="token keyword">const</span> <span class="token function-variable function">onAddToCart</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token constant">REDUCER_ACTIONS</span><span class="token punctuation">.</span><span class="token constant">ADD</span><span class="token punctuation">,</span> payload<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token operator">...</span>product<span class="token punctuation">,</span> qty<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 如果產品已在購物車中，顯示標記</span>
  <span class="token keyword">const</span> itemInCart <span class="token operator">=</span> inCart <span class="token operator">?</span> <span class="token string">&quot; → Item in Cart: ✔️&quot;</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

  <span class="token comment">// 產品的展示內容</span>
  <span class="token keyword">const</span> content <span class="token operator">=</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>article</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>product<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>product<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>img<span class="token punctuation">}</span></span> <span class="token attr-name">alt</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>product<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>product__img<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token punctuation">{</span><span class="token keyword">new</span> <span class="token class-name">Intl</span><span class="token punctuation">.</span><span class="token function">NumberFormat</span><span class="token punctuation">(</span><span class="token string">&quot;en-US&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
          style<span class="token operator">:</span> <span class="token string">&quot;currency&quot;</span><span class="token punctuation">,</span>
          currency<span class="token operator">:</span> <span class="token string">&quot;USD&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>product<span class="token punctuation">.</span>price<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
        </span><span class="token punctuation">{</span>itemInCart<span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>onAddToCart<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Add to Cart</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>article</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> content<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 比較函數，用於優化性能，避免不必要的重新渲染</span>
<span class="token keyword">function</span> <span class="token function">areProductsEqual</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span> product<span class="token operator">:</span> prevProduct<span class="token punctuation">,</span> inCart<span class="token operator">:</span> prevInCart <span class="token punctuation">}</span><span class="token operator">:</span> PropsType<span class="token punctuation">,</span>
  <span class="token punctuation">{</span> product<span class="token operator">:</span> nextProduct<span class="token punctuation">,</span> inCart<span class="token operator">:</span> nextInCart <span class="token punctuation">}</span><span class="token operator">:</span> PropsType
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>prevProduct<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">every</span><span class="token punctuation">(</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span>
        prevProduct<span class="token punctuation">[</span>key <span class="token keyword">as</span> <span class="token keyword">keyof</span> ProductType<span class="token punctuation">]</span> <span class="token operator">===</span>
        nextProduct<span class="token punctuation">[</span>key <span class="token keyword">as</span> <span class="token keyword">keyof</span> ProductType<span class="token punctuation">]</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> prevInCart <span class="token operator">===</span> nextInCart
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 使用 memo 包裝 Product 組件，優化渲染性能</span>
<span class="token keyword">const</span> MemoizedProduct <span class="token operator">=</span> <span class="token generic-function"><span class="token function">memo</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">typeof</span> Product<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>Product<span class="token punctuation">,</span> areProductsEqual<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> MemoizedProduct<span class="token punctuation">;</span>
</code></pre></div><h2 id="トラブルシューティング"><a href="#トラブルシューティング" class="header-anchor">#</a> トラブルシューティング</h2> <h3 id="▫️-usecartcontext-hooks"><a href="#▫️-usecartcontext-hooks" class="header-anchor">#</a> ▫️ useCartContext hooks</h3> <blockquote><p>這段代碼定义了一个名为 <code>useCartContext</code> 的自定义 React Hook。这个 Hook 使用了 React 的几个内置功能，如 <code>useReducer</code> 和 <code>useMemo</code>，来管理和优化购物车应用的状态。下面是对每个部分的详细解释：</p></blockquote> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">const</span> <span class="token function-variable function">useCartContext</span> <span class="token operator">=</span> <span class="token punctuation">(</span>initialCartState<span class="token operator">:</span> CartStateType<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> initialCartState<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//useMemo 主要用于缓存计算结果，并在依赖项（dependencies）发生变化时重新计算。</span>
  <span class="token keyword">const</span> <span class="token constant">REDUCER_ACTIONS</span> <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token constant">REDUCER_ACTION_TYPE</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> totalItems <span class="token operator">=</span> state<span class="token punctuation">.</span>cart<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>previousValue<span class="token punctuation">,</span> cartItem<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> previousValue <span class="token operator">+</span> cartItem<span class="token punctuation">.</span>qty<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> totalPrice <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intl</span><span class="token punctuation">.</span><span class="token function">NumberFormat</span><span class="token punctuation">(</span><span class="token string">&quot;en-US&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    style<span class="token operator">:</span> <span class="token string">&quot;currency&quot;</span><span class="token punctuation">,</span>
    currency<span class="token operator">:</span> <span class="token string">&quot;USD&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>
    state<span class="token punctuation">.</span>cart<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>previousValue<span class="token punctuation">,</span> cartItem<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> previousValue <span class="token operator">+</span> cartItem<span class="token punctuation">.</span>qty <span class="token operator">*</span> cartItem<span class="token punctuation">.</span>price<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 这段代码的作用是对购物车中的商品进行排序，排序的规则是按照商品的 sku 属性的后四位数字进行升序排序。</span>
  <span class="token keyword">const</span> cart <span class="token operator">=</span> state<span class="token punctuation">.</span>cart<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//分别提取了商品 a 和 b 的 sku 属性的后四位数字部分。这些数字会被转换成数值类型。</span>
    <span class="token keyword">const</span> itemA <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>sku<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> itemB <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>sku<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//表示根据提取出的数字进行升序排序，即如果 itemA 小于 itemB，返回负数；如果 itemA 等于 itemB，返回零；如果 itemA 大于 itemB，返回正数。</span>
    <span class="token keyword">return</span> itemA <span class="token operator">-</span> itemB<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span> dispatch<span class="token punctuation">,</span> <span class="token constant">REDUCER_ACTIONS</span><span class="token punctuation">,</span> totalPrice<span class="token punctuation">,</span> totalItems<span class="token punctuation">,</span> cart <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>useReducer</p></blockquote> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> initialCartState<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>这里使用了 <code>useReducer</code> Hook 来管理购物车的状态。<code>useReducer</code> 是一个替代 <code>useState</code> 的 Hook，适用于复杂的状态逻辑，可以让你根据 action 更新状态。</li> <li><code>reducer</code> 是一个函数，定义了状态如何响应不同的 action 类型。</li> <li><code>initialCartState</code> 是购物车的初始状态。</li> <li><code>state</code> 代表当前的状态，<code>dispatch</code> 是一个函数，用来发送 action 到 reducer。</li></ul> <blockquote><p>useMemo</p></blockquote> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> <span class="token constant">REDUCER_ACTIONS</span> <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token constant">REDUCER_ACTION_TYPE</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li><code>useMemo</code> 用于缓存计算的结果。这里它被用来缓存 <code>REDUCER_ACTION_TYPE</code> 对象。</li> <li>依赖项数组（<code>[]</code>）为空，这意味着 <code>REDUCER_ACTIONS</code> 只会在组件首次渲染时计算一次。</li></ul> <blockquote><p>计算总数和总价</p></blockquote> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> totalItems <span class="token operator">=</span> state<span class="token punctuation">.</span>cart<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>previousValue<span class="token punctuation">,</span> cartItem<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> previousValue <span class="token operator">+</span> cartItem<span class="token punctuation">.</span>qty<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> totalPrice <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intl</span><span class="token punctuation">.</span><span class="token function">NumberFormat</span><span class="token punctuation">(</span><span class="token string">&quot;en-US&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  style<span class="token operator">:</span> <span class="token string">&quot;currency&quot;</span><span class="token punctuation">,</span>
  currency<span class="token operator">:</span> <span class="token string">&quot;USD&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>
  state<span class="token punctuation">.</span>cart<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>previousValue<span class="token punctuation">,</span> cartItem<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> previousValue <span class="token operator">+</span> cartItem<span class="token punctuation">.</span>qty <span class="token operator">*</span> cartItem<span class="token punctuation">.</span>price<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>这两个变量使用 <code>reduce</code> 方法来计算购物车中商品的总数量 (<code>totalItems</code>) 和总价 (<code>totalPrice</code>)。</li></ul> <blockquote><p>对购物车商品进行排序</p></blockquote> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> cart <span class="token operator">=</span> state<span class="token punctuation">.</span>cart<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> itemA <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>sku<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> itemB <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>sku<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> itemA <span class="token operator">-</span> itemB<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>这段代码对购物车中的商品根据 <code>sku</code> 的后四位数字进行升序排序。</li></ul> <blockquote><p>返回值</p></blockquote> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">return</span> <span class="token punctuation">{</span> dispatch<span class="token punctuation">,</span> <span class="token constant">REDUCER_ACTIONS</span><span class="token punctuation">,</span> totalPrice<span class="token punctuation">,</span> totalItems<span class="token punctuation">,</span> cart <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><ul><li><code>useCartContext</code> 返回一个包含 <code>dispatch</code> 函数、动作类型 (<code>REDUCER_ACTIONS</code>)、购物车总价 (<code>totalPrice</code>)、总数量 (<code>totalItems</code>) 和排序后的购物车商品列表 (<code>cart</code>) 的对象。</li> <li>这个 Hook 可以被用于组件中，以便于访问和操作购物车的状态。</li></ul> <p>总的来说，<code>useCartContext</code> Hook 为购物车应用提供了一个集中的状态管理方案，使得状态的读取和更新更加方便和高效。</p> <h3 id="▫️-usecartcontexttype"><a href="#▫️-usecartcontexttype" class="header-anchor">#</a> ▫️ UseCartContextType</h3> <blockquote><p>在 TypeScript 中定义 <code>UseCartContextType</code> 类型作为 <code>ReturnType&lt;typeof useCartContext&gt;</code> 的原因是为了确保类型安全和代码的清晰性。这里解释一下具体原因和用途：</p></blockquote> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">export</span> <span class="token keyword">type</span> <span class="token class-name">UseCartContextType</span> <span class="token operator">=</span> ReturnType<span class="token operator">&lt;</span><span class="token keyword">typeof</span> useCartContext<span class="token operator">&gt;</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>为什么要确定返回值的类型</p></blockquote> <ol><li><strong>类型安全</strong>:</li></ol> <ul><li>TypeScript 强类型系统的一个主要优点是它提供了类型安全。通过明确指定函数返回值的类型，你可以在编译时捕捉潜在的错误，而不是在运行时。</li> <li>在这个案例中，<code>useCartContext</code> 是一个自定义 Hook，它可能返回一个复杂的对象，包含多个属性和方法。使用 <code>ReturnType</code> 可以确保你完全理解并正确处理这个 Hook 返回的数据结构。</li></ul> <ol start="2"><li><strong>自动推断</strong>:</li></ol> <ul><li><code>ReturnType&lt;typeof useCartContext&gt;</code> 自动推断 <code>useCartContext</code> Hook 的返回值类型。这意味着如果 <code>useCartContext</code> 的实现更改了返回值的结构，<code>UseCartContextType</code> 也会相应地更新，无需手动更改。</li></ul> <blockquote><p>返回值是什么</p></blockquote> <ul><li><strong>返回值</strong>:</li> <li><code>useCartContext</code> Hook 的返回值是一个对象，包含了与购物车相关的数据和函数。这通常包括购物车的状态（如商品列表、总价等）以及用于更新这些状态的方法（如 dispatch 方法）。</li></ul> <blockquote><p>在什么地方用</p></blockquote> <ol><li><strong>在 Context 提供者中</strong>:</li></ol> <ul><li>当你创建一个 Context 并且想要在整个应用中共享 <code>useCartContext</code> 提供的数据和函数时，可以使用这个类型。例如，在 <code>CartProvider</code> 组件中，你可能会将 <code>useCartContext</code> 的返回值作为 Context 的值。</li></ul> <ol start="2"><li><strong>在消费者组件中</strong>:</li></ol> <ul><li>组件可以通过 <code>useContext(CartContext)</code> 使用这个类型来访问购物车的数据和操作函数。这样可以确保组件正确地使用了 Context 提供的数据，同时也享受到了 TypeScript 的类型检查和自动完成的好处。</li></ul> <p>总之，<code>UseCartContextType</code> 的定义和使用使得你的 React 组件可以高效且安全地与购物车相关的状态和操作进行交互，同时保持代码的清晰和可维护性。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/practice/todolist.html" class="prev">
        TodoList App
      </a></span> <span class="next"><a href="/practice/github.html">
        /practice/github.html
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.204ed3d4.js" defer></script><script src="/assets/js/2.a44fb3b0.js" defer></script><script src="/assets/js/1.8d37d391.js" defer></script><script src="/assets/js/55.a4b8b234.js" defer></script>
  </body>
</html>
